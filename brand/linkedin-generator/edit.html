<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Editor | LinkedIn Content Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ========================================
           RME BRAND VARIABLES
           ======================================== */
        :root {
            --color-dark: #134e4a;
            --color-accent: #0d9488;
            --color-accent-hover: #0f766e;
            --color-white: #ffffff;
            --color-off-white: #fafcfc;
            --color-light: #f0fdfa;
            --color-light-alt: #ccfbf1;
            --color-muted: #6b7280;
            --color-border: #e5e7eb;
            --color-success: #1fa95c;
            --color-warning: #f9943b;
            --color-danger: #f33144;
            --color-secondary: #fbbf24;
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --space-xs: 8px;
            --space-sm: 16px;
            --space-md: 24px;
            --space-lg: 32px;
            --space-xl: 48px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-family);
            background: #1a1a2e;
            color: var(--color-white);
            min-height: 100vh;
        }

        /* Navigation */
        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            background: #16162a;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-brand img { height: 28px; }
        .nav-brand h1 { font-size: 14px; font-weight: 600; }

        .nav-links { display: flex; gap: 16px; }

        .nav-link {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            padding: 8px 14px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav-link:hover {
            color: white;
            background: rgba(255,255,255,0.1);
        }

        /* Layout */
        .app {
            display: grid;
            grid-template-columns: 340px 1fr;
            height: calc(100vh - 53px);
        }

        .sidebar {
            background: #16162a;
            border-right: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar-content {
            padding: var(--space-md);
            flex: 1;
            overflow-y: auto;
        }

        .sidebar-footer {
            padding: var(--space-md);
            border-top: 1px solid rgba(255,255,255,0.1);
            background: #16162a;
        }

        .preview-area {
            background: #1a1a2e;
            padding: var(--space-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }

        /* Control Components */
        .control-section {
            margin-bottom: var(--space-lg);
        }

        .control-section h3 {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--color-muted);
            margin-bottom: var(--space-sm);
        }

        .control-group {
            margin-bottom: var(--space-md);
        }

        .control-label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: rgba(255,255,255,0.7);
            margin-bottom: 6px;
        }

        .input-text,
        .input-textarea,
        .input-select {
            width: 100%;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius-sm);
            padding: 10px 12px;
            font-size: 13px;
            font-family: var(--font-family);
            color: var(--color-white);
            transition: border-color 0.2s;
        }

        .input-text:focus,
        .input-textarea:focus,
        .input-select:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        .input-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .input-hint {
            font-size: 10px;
            color: var(--color-muted);
            margin-top: 4px;
        }

        /* Slider */
        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-label {
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            width: 20px;
            text-align: center;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: var(--color-accent);
            border-radius: 50%;
            cursor: pointer;
        }

        .slider-value {
            font-size: 11px;
            color: rgba(255,255,255,0.6);
            width: 35px;
            text-align: right;
        }

        /* Image Grid */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            max-height: 180px;
            overflow-y: auto;
            padding: 4px;
        }

        .image-item {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
            padding: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-item:hover { background: rgba(255,255,255,0.1); }
        .image-item.selected {
            border-color: var(--color-accent);
            background: rgba(13, 148, 136, 0.2);
        }
        .image-item img { width: 100%; height: 100%; object-fit: contain; }

        /* Gradient Grid */
        .gradient-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .gradient-item {
            aspect-ratio: 1;
            border-radius: var(--radius-sm);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s;
            position: relative;
        }

        .gradient-item:hover { transform: scale(1.05); }
        .gradient-item.selected {
            border-color: var(--color-white);
            box-shadow: 0 0 0 2px var(--color-accent);
        }

        .gradient-item span {
            position: absolute;
            bottom: 2px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 8px;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        /* Theme Grid */
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .theme-item {
            aspect-ratio: 1;
            border-radius: var(--radius-sm);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s;
            position: relative;
        }

        .theme-item:hover { transform: scale(1.05); }
        .theme-item.selected {
            border-color: var(--color-accent);
            box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.3);
        }

        .theme-item span {
            position: absolute;
            bottom: 4px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 9px;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* Format Grid */
        .format-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .format-item {
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
            padding: 12px 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s;
            text-align: center;
        }

        .format-item:hover { background: rgba(255,255,255,0.1); }
        .format-item.selected {
            border-color: var(--color-accent);
            background: rgba(13, 148, 136, 0.2);
        }

        .format-item .icon {
            margin: 0 auto 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .format-item .icon.square { width: 28px; height: 28px; }
        .format-item .icon.portrait { width: 24px; height: 30px; }
        .format-item .icon.landscape { width: 36px; height: 19px; }

        .format-item span { font-size: 11px; color: rgba(255,255,255,0.7); }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 16px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            font-family: var(--font-family);
            cursor: pointer;
            border: none;
            transition: all 0.15s;
            width: 100%;
        }

        .btn-primary { background: var(--color-accent); color: white; }
        .btn-primary:hover { background: var(--color-accent-hover); }
        .btn-secondary { background: rgba(255,255,255,0.1); color: white; }
        .btn-secondary:hover { background: rgba(255,255,255,0.15); }

        .btn-group { display: flex; gap: 8px; }
        .btn-group .btn { flex: 1; }

        /* ========================================
           PREVIEW - SLIDE CONTAINER
           ======================================== */
        .preview-container {
            background: #0d0d1a;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .slide-preview {
            position: relative;
            overflow: hidden;
            font-family: var(--font-family);
        }

        .slide-preview.size-square { width: 400px; height: 400px; }
        .slide-preview.size-portrait { width: 400px; height: 500px; }
        .slide-preview.size-landscape { width: 500px; height: 262px; }

        /* Theme Backgrounds */
        .slide-preview.theme-dark {
            background: linear-gradient(135deg, #134e4a 0%, #0f3d3a 100%);
            color: white;
        }
        .slide-preview.theme-light {
            background: linear-gradient(135deg, #f0fdfa 0%, #e6f9f6 100%);
            color: #134e4a;
        }
        .slide-preview.theme-accent {
            background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%);
            color: white;
        }
        .slide-preview.theme-white {
            background: white;
            color: #134e4a;
        }

        /* ========================================
           TEMPLATE TYPE: STATEMENT
           ======================================== */
        .tpl-statement {
            padding: 8%;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .tpl-statement .logo {
            position: absolute;
            z-index: 10;
        }

        .tpl-statement .logo img {
            height: 100%;
            width: auto;
        }

        .tpl-statement .badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            width: fit-content;
        }

        .tpl-statement .badge.badge-accent {
            background: rgba(13, 148, 136, 0.15);
            color: var(--color-accent);
        }
        .tpl-statement .badge.badge-danger {
            background: rgba(243, 49, 68, 0.15);
            color: var(--color-danger);
        }
        .theme-dark .tpl-statement .badge.badge-accent,
        .theme-accent .tpl-statement .badge.badge-accent {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .tpl-statement .brand {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            opacity: 0.8;
            margin-bottom: 12px;
        }

        .tpl-statement .headline {
            font-size: 36px;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 16px;
            white-space: pre-line;
        }

        .tpl-statement .body {
            font-size: 18px;
            line-height: 1.5;
            opacity: 0.9;
            margin-bottom: 24px;
        }

        .tpl-statement .cta {
            display: inline-block;
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 15px;
            font-weight: 600;
            width: fit-content;
            margin-top: auto;
        }

        .theme-dark .tpl-statement .cta,
        .theme-accent .tpl-statement .cta {
            background: white;
            color: var(--color-dark);
        }
        .theme-light .tpl-statement .cta,
        .theme-white .tpl-statement .cta {
            background: var(--color-accent);
            color: white;
        }

        .tpl-statement .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* ========================================
           TEMPLATE TYPE: STAT FOCUS
           ======================================== */
        .tpl-stat {
            padding: 8%;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .tpl-stat .label {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            opacity: 0.8;
            margin-bottom: 24px;
        }

        .tpl-stat .stat-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            margin-bottom: 24px;
        }

        .theme-light .tpl-stat .stat-box,
        .theme-white .tpl-stat .stat-box {
            background: rgba(13, 148, 136, 0.08);
            border-color: rgba(13, 148, 136, 0.2);
        }

        .tpl-stat .stat-value {
            font-size: 64px;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 8px;
        }

        .tpl-stat .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .tpl-stat .description {
            font-size: 18px;
            line-height: 1.5;
            text-align: center;
            opacity: 0.9;
            margin-bottom: 24px;
        }

        .tpl-stat .source {
            font-size: 13px;
            opacity: 0.6;
            text-align: center;
            margin-top: auto;
        }

        /* ========================================
           TEMPLATE TYPE: CHECKLIST
           ======================================== */
        .tpl-checklist {
            padding: 8%;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .tpl-checklist .label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
            opacity: 0.7;
            margin-bottom: 12px;
        }

        .tpl-checklist .headline {
            font-size: 32px;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 24px;
        }

        .tpl-checklist .items {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-bottom: 24px;
        }

        .tpl-checklist .item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            font-weight: 500;
        }

        .tpl-checklist .item-icon {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .tpl-checklist .item-icon.good {
            background: var(--color-success);
            color: white;
        }
        .tpl-checklist .item-icon.bad {
            background: var(--color-danger);
            color: white;
        }

        .tpl-checklist .cta {
            display: inline-block;
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 15px;
            font-weight: 600;
            width: fit-content;
            margin-top: auto;
            text-align: center;
        }

        .theme-dark .tpl-checklist .cta,
        .theme-accent .tpl-checklist .cta {
            background: white;
            color: var(--color-dark);
        }
        .theme-light .tpl-checklist .cta,
        .theme-white .tpl-checklist .cta {
            background: var(--color-dark);
            color: white;
        }

        /* ========================================
           TEMPLATE TYPE: QUOTE
           ======================================== */
        .tpl-quote {
            padding: 8%;
            display: flex;
            flex-direction: column;
            height: 100%;
            text-align: center;
            justify-content: center;
        }

        .tpl-quote .quote-mark {
            font-size: 72px;
            line-height: 1;
            color: var(--color-accent);
            margin-bottom: -10px;
        }

        .theme-dark .tpl-quote .quote-mark,
        .theme-accent .tpl-quote .quote-mark {
            color: rgba(255,255,255,0.3);
        }

        .tpl-quote .quote-text {
            font-size: 28px;
            font-weight: 600;
            font-style: italic;
            line-height: 1.3;
            margin-bottom: 20px;
        }

        .tpl-quote .divider {
            width: 40px;
            height: 3px;
            background: var(--color-accent);
            margin: 0 auto 20px;
        }

        .theme-dark .tpl-quote .divider,
        .theme-accent .tpl-quote .divider {
            background: rgba(255,255,255,0.4);
        }

        .tpl-quote .attribution {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 24px;
        }

        .tpl-quote .author-box {
            background: rgba(255,255,255,0.1);
            padding: 16px;
            border-radius: 8px;
            margin-top: auto;
        }

        .theme-light .tpl-quote .author-box,
        .theme-white .tpl-quote .author-box {
            background: rgba(13, 148, 136, 0.08);
        }

        .tpl-quote .author-name {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .tpl-quote .author-title {
            font-size: 12px;
            opacity: 0.7;
        }

        /* Logo positioning */
        .logo-wrapper {
            position: absolute;
            z-index: 10;
        }
        .logo-wrapper img {
            height: 100%;
            width: auto;
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-brand">
            <img src="../../svg/Horizontal-Logo.svg" alt="Review My Emails">
            <h1>Template Editor</h1>
        </div>
        <div class="nav-links">
            <a href="templates.html" class="nav-link">Template Library</a>
            <a href="index.html" class="nav-link">Advanced Editor</a>
        </div>
    </nav>

    <div class="app">
        <div class="sidebar">
            <div class="sidebar-content">
                <!-- Format -->
                <div class="control-section">
                    <h3>Format</h3>
                    <div class="format-grid">
                        <div class="format-item selected" data-format="square">
                            <div class="icon square"></div>
                            <span>Square</span>
                        </div>
                        <div class="format-item" data-format="portrait">
                            <div class="icon portrait"></div>
                            <span>Portrait</span>
                        </div>
                        <div class="format-item" data-format="landscape">
                            <div class="icon landscape"></div>
                            <span>Landscape</span>
                        </div>
                    </div>
                </div>

                <!-- Theme -->
                <div class="control-section">
                    <h3>Theme</h3>
                    <div class="theme-grid">
                        <div class="theme-item selected" data-theme="dark" style="background: linear-gradient(135deg, #134e4a, #0f3d3a); color: white;">
                            <span>Dark</span>
                        </div>
                        <div class="theme-item" data-theme="light" style="background: linear-gradient(135deg, #f0fdfa, #e6f9f6); color: #134e4a;">
                            <span>Light</span>
                        </div>
                        <div class="theme-item" data-theme="accent" style="background: linear-gradient(135deg, #0d9488, #0f766e); color: white;">
                            <span>Accent</span>
                        </div>
                        <div class="theme-item" data-theme="white" style="background: white; color: #134e4a; border: 1px solid #e5e5e5;">
                            <span>White</span>
                        </div>
                    </div>
                </div>

                <!-- Logo -->
                <div class="control-section">
                    <h3>Logo</h3>
                    <div class="control-group">
                        <label class="control-label">Select Logo</label>
                        <div class="image-grid" id="logoGrid"></div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Position X</label>
                        <div class="slider-group">
                            <span class="slider-label">L</span>
                            <input type="range" class="slider" id="logoX" min="0" max="100" value="8">
                            <span class="slider-label">R</span>
                            <span class="slider-value" id="logoXValue">8%</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Position Y</label>
                        <div class="slider-group">
                            <span class="slider-label">T</span>
                            <input type="range" class="slider" id="logoY" min="0" max="100" value="8">
                            <span class="slider-label">B</span>
                            <span class="slider-value" id="logoYValue">8%</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Size</label>
                        <div class="slider-group">
                            <span class="slider-label">S</span>
                            <input type="range" class="slider" id="logoZoom" min="20" max="80" value="36">
                            <span class="slider-label">L</span>
                            <span class="slider-value" id="logoZoomValue">36px</span>
                        </div>
                    </div>
                </div>

                <!-- Content (dynamic based on template type) -->
                <div class="control-section" id="contentControls">
                    <h3>Content</h3>
                    <!-- Populated by JS based on template type -->
                </div>

                <!-- Background -->
                <div class="control-section">
                    <h3>Background</h3>
                    <div class="control-group">
                        <label class="control-label">Gradient Presets</label>
                        <div class="gradient-grid" id="gradientPresets"></div>
                    </div>
                </div>
            </div>

            <div class="sidebar-footer">
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="copyToClipboard()">Copy</button>
                    <button class="btn btn-primary" onclick="downloadImage()">Download</button>
                </div>
            </div>
        </div>

        <div class="preview-area">
            <div class="preview-container">
                <div class="slide-preview size-square theme-dark" id="slidePreview">
                    <!-- Template content rendered here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // CONSTANTS
        // ========================================
        const LOGOS = [
            { file: 'Horizontal-Logo.svg', name: 'Horizontal' },
            { file: 'Dark-Horizontal-Logo.svg', name: 'Dark Horizontal' },
            { file: 'Vertical-Logo.svg', name: 'Vertical' },
            { file: 'Dark-Vertical-Logo.svg', name: 'Dark Vertical' },
            { file: 'Square-Logo.svg', name: 'Square' },
            { file: 'Dark-Square-Logo.svg', name: 'Dark Square' },
            { file: 'Icon.svg', name: 'Icon' },
            { file: 'Dark-Icon.svg', name: 'Dark Icon' }
        ];

        const GRADIENT_PRESETS = [
            { name: 'Teal Deep', start: '#134e4a', end: '#0f3d3a', usage: 'Hero sections, authority posts' },
            { name: 'Teal Accent', start: '#0d9488', end: '#0f766e', usage: 'CTAs, engagement posts' },
            { name: 'Teal Light', start: '#14b8a6', end: '#0d9488', usage: 'Tips, announcements' },
            { name: 'Ocean', start: '#134e4a', end: '#0d9488', usage: 'Educational content' },
            { name: 'Midnight', start: '#1a1a2e', end: '#16162a', usage: 'Dark mode, tech' },
            { name: 'Charcoal', start: '#374151', end: '#1f2937', usage: 'Professional, B2B' },
            { name: 'Slate', start: '#475569', end: '#334155', usage: 'Neutral, data' },
            { name: 'Deep Sea', start: '#164e63', end: '#0c4a6e', usage: 'Trust signals' },
            { name: 'Sunset', start: '#f97316', end: '#ea580c', usage: 'Warnings, urgency' },
            { name: 'Gold', start: '#fbbf24', end: '#f59e0b', usage: 'Premium, highlights' },
            { name: 'Fire', start: '#ef4444', end: '#dc2626', usage: 'Danger, blacklist' },
            { name: 'Sky', start: '#38bdf8', end: '#0ea5e9', usage: 'Info, tutorials' },
            { name: 'Mint', start: '#34d399', end: '#10b981', usage: 'Success, verified' },
            { name: 'Indigo', start: '#818cf8', end: '#6366f1', usage: 'Creative, AI' },
            { name: 'Lavender', start: '#a78bfa', end: '#8b5cf6', usage: 'Unique content' },
            { name: 'Coral', start: '#fb7185', end: '#f43f5e', usage: 'Soft alerts' }
        ];

        // Template definitions
        const TEMPLATES = {
            'dark-statement-sq': {
                type: 'statement',
                format: 'square',
                theme: 'dark',
                data: {
                    brand: 'REVIEW MY EMAILS',
                    headline: 'Stop guessing.\nStart knowing.',
                    body: 'Your bounce rate is telling a story. Are you listening?',
                    cta: 'Get Free Audit'
                }
            },
            'minimal-tip-sq': {
                type: 'statement',
                format: 'square',
                theme: 'light',
                data: {
                    badge: 'Pro Tip',
                    badgeColor: 'accent',
                    brand: 'REVIEW MY EMAILS',
                    headline: 'The "Restraint"\nStrategy.',
                    body: 'When inbox placement weakens, pushing harder rarely fixes it.',
                    cta: null
                }
            },
            'stat-focus-sq': {
                type: 'stat',
                format: 'square',
                theme: 'accent',
                data: {
                    label: 'DID YOU KNOW?',
                    stat: '22.5%',
                    statLabel: 'Average database decay per year',
                    description: 'If you haven\'t cleaned your list in a year, nearly a quarter of it is risky.',
                    source: 'Source: Industry Benchmarks'
                }
            },
            'risk-alert-sq': {
                type: 'checklist',
                format: 'square',
                theme: 'white',
                data: {
                    badge: 'Alert',
                    badgeColor: 'danger',
                    headline: 'Is your domain blacklisted?',
                    items: [
                        { text: 'Emails going to spam', status: 'bad' },
                        { text: 'Open rates dropping', status: 'bad' },
                        { text: 'Providers blocking you', status: 'bad' }
                    ],
                    cta: null
                }
            },
            'checklist-pt': {
                type: 'checklist',
                format: 'portrait',
                theme: 'light',
                data: {
                    label: 'DELIVERABILITY 101',
                    headline: 'The Safe Sender Checklist',
                    items: [
                        { text: 'SPF Record Configured', status: 'good' },
                        { text: 'DKIM Signature Valid', status: 'good' },
                        { text: 'DMARC Policy Active', status: 'good' },
                        { text: 'Hard Bounces Removed', status: 'good' }
                    ],
                    cta: 'Download Guide'
                }
            },
            'quote-pt': {
                type: 'quote',
                format: 'portrait',
                theme: 'dark',
                data: {
                    quote: 'Trust is the currency of the inbox.',
                    attribution: 'Without it, your offers are invisible.',
                    author: 'Review My Emails',
                    authorTitle: 'Deliverability Experts'
                }
            }
        };

        // ========================================
        // STATE
        // ========================================
        let state = {
            templateId: null,
            templateType: 'statement',
            format: 'square',
            theme: 'dark',
            logo: {
                file: 'Horizontal-Logo.svg',
                x: 8,
                y: 8,
                zoom: 36
            },
            gradient: null,
            data: {}
        };

        // ========================================
        // INITIALIZATION
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            initLogoGrid();
            initGradientPresets();
            initFormatListeners();
            initThemeListeners();
            initLogoSliders();
            loadTemplateFromURL();
            renderPreview();
        });

        function loadTemplateFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const templateId = urlParams.get('template');

            if (templateId && TEMPLATES[templateId]) {
                const template = TEMPLATES[templateId];
                state.templateId = templateId;
                state.templateType = template.type;
                state.format = template.format;
                state.theme = template.theme;
                state.data = { ...template.data };

                // Update UI
                document.querySelectorAll('.format-item').forEach(i =>
                    i.classList.toggle('selected', i.dataset.format === state.format));
                document.querySelectorAll('.theme-item').forEach(i =>
                    i.classList.toggle('selected', i.dataset.theme === state.theme));
            } else {
                // Default template
                state.templateType = 'statement';
                state.data = {
                    brand: 'REVIEW MY EMAILS',
                    headline: 'Your headline here',
                    body: 'Supporting text goes here',
                    cta: 'Learn More'
                };
            }

            renderContentControls();
            renderPreview();
        }

        function initLogoGrid() {
            const grid = document.getElementById('logoGrid');
            grid.innerHTML = LOGOS.map((logo, i) => `
                <div class="image-item ${i === 0 ? 'selected' : ''}" data-logo="${logo.file}" title="${logo.name}">
                    <img src="../../svg/${logo.file}" alt="${logo.name}">
                </div>
            `).join('');

            grid.querySelectorAll('.image-item').forEach(item => {
                item.addEventListener('click', () => {
                    grid.querySelectorAll('.image-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    state.logo.file = item.dataset.logo;
                    renderPreview();
                });
            });
        }

        function initGradientPresets() {
            const grid = document.getElementById('gradientPresets');
            grid.innerHTML = GRADIENT_PRESETS.map((grad, i) => `
                <div class="gradient-item" data-start="${grad.start}" data-end="${grad.end}"
                     style="background: linear-gradient(135deg, ${grad.start}, ${grad.end});"
                     title="${grad.name}: ${grad.usage}">
                    <span>${grad.name}</span>
                </div>
            `).join('');

            grid.querySelectorAll('.gradient-item').forEach(item => {
                item.addEventListener('click', () => {
                    grid.querySelectorAll('.gradient-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    state.gradient = {
                        start: item.dataset.start,
                        end: item.dataset.end
                    };
                    renderPreview();
                });
            });
        }

        function initFormatListeners() {
            document.querySelectorAll('.format-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.format-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    state.format = item.dataset.format;
                    renderPreview();
                });
            });
        }

        function initThemeListeners() {
            document.querySelectorAll('.theme-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.theme-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    state.theme = item.dataset.theme;
                    state.gradient = null; // Reset gradient when theme changes
                    document.querySelectorAll('.gradient-item').forEach(i => i.classList.remove('selected'));
                    renderPreview();
                });
            });
        }

        function initLogoSliders() {
            ['logoX', 'logoY', 'logoZoom'].forEach(id => {
                const slider = document.getElementById(id);
                slider.addEventListener('input', (e) => {
                    const key = id.replace('logo', '').toLowerCase();
                    state.logo[key === 'zoom' ? 'zoom' : key] = parseInt(e.target.value);
                    document.getElementById(id + 'Value').textContent =
                        key === 'zoom' ? e.target.value + 'px' : e.target.value + '%';
                    renderPreview();
                });
            });
        }

        // ========================================
        // CONTENT CONTROLS (Type-specific)
        // ========================================
        function renderContentControls() {
            const container = document.getElementById('contentControls');
            let html = '<h3>Content</h3>';

            switch (state.templateType) {
                case 'statement':
                    html += `
                        <div class="control-group">
                            <label class="control-label">Badge (optional)</label>
                            <input type="text" class="input-text" id="inputBadge" value="${state.data.badge || ''}" placeholder="e.g., Pro Tip">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Brand Text</label>
                            <input type="text" class="input-text" id="inputBrand" value="${state.data.brand || ''}" placeholder="REVIEW MY EMAILS">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Headline</label>
                            <textarea class="input-textarea" id="inputHeadline" placeholder="Main headline">${state.data.headline || ''}</textarea>
                            <div class="input-hint">Use [red:text] for colored text</div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Body Text</label>
                            <textarea class="input-textarea" id="inputBody" placeholder="Supporting text">${state.data.body || ''}</textarea>
                        </div>
                        <div class="control-group">
                            <label class="control-label">CTA Button (optional)</label>
                            <input type="text" class="input-text" id="inputCta" value="${state.data.cta || ''}" placeholder="e.g., Learn More">
                        </div>
                    `;
                    break;

                case 'stat':
                    html += `
                        <div class="control-group">
                            <label class="control-label">Top Label</label>
                            <input type="text" class="input-text" id="inputLabel" value="${state.data.label || ''}" placeholder="DID YOU KNOW?">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Stat Value</label>
                            <input type="text" class="input-text" id="inputStat" value="${state.data.stat || ''}" placeholder="22.5%">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Stat Label</label>
                            <input type="text" class="input-text" id="inputStatLabel" value="${state.data.statLabel || ''}" placeholder="Average database decay">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Description</label>
                            <textarea class="input-textarea" id="inputDescription">${state.data.description || ''}</textarea>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Source</label>
                            <input type="text" class="input-text" id="inputSource" value="${state.data.source || ''}" placeholder="Source: ...">
                        </div>
                    `;
                    break;

                case 'checklist':
                    const itemsText = (state.data.items || []).map(i =>
                        (i.status === 'good' ? '+ ' : '- ') + i.text
                    ).join('\n');
                    html += `
                        <div class="control-group">
                            <label class="control-label">Badge (optional)</label>
                            <input type="text" class="input-text" id="inputBadge" value="${state.data.badge || ''}" placeholder="e.g., Alert">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Label (optional)</label>
                            <input type="text" class="input-text" id="inputLabel" value="${state.data.label || ''}" placeholder="DELIVERABILITY 101">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Headline</label>
                            <input type="text" class="input-text" id="inputHeadline" value="${state.data.headline || ''}" placeholder="The Safe Sender Checklist">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Checklist Items</label>
                            <textarea class="input-textarea" id="inputItems" placeholder="+ Good item\n- Bad item">${itemsText}</textarea>
                            <div class="input-hint">Start with + for green check, - for red X</div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">CTA Button (optional)</label>
                            <input type="text" class="input-text" id="inputCta" value="${state.data.cta || ''}" placeholder="e.g., Download Guide">
                        </div>
                    `;
                    break;

                case 'quote':
                    html += `
                        <div class="control-group">
                            <label class="control-label">Quote</label>
                            <textarea class="input-textarea" id="inputQuote">${state.data.quote || ''}</textarea>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Attribution</label>
                            <input type="text" class="input-text" id="inputAttribution" value="${state.data.attribution || ''}" placeholder="Supporting context">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Author Name</label>
                            <input type="text" class="input-text" id="inputAuthor" value="${state.data.author || ''}" placeholder="Review My Emails">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Author Title</label>
                            <input type="text" class="input-text" id="inputAuthorTitle" value="${state.data.authorTitle || ''}" placeholder="Deliverability Experts">
                        </div>
                    `;
                    break;
            }

            container.innerHTML = html;

            // Add event listeners to all inputs
            container.querySelectorAll('input, textarea').forEach(input => {
                input.addEventListener('input', () => {
                    updateStateFromInputs();
                    renderPreview();
                });
            });
        }

        function updateStateFromInputs() {
            switch (state.templateType) {
                case 'statement':
                    state.data.badge = document.getElementById('inputBadge')?.value || null;
                    state.data.brand = document.getElementById('inputBrand')?.value || '';
                    state.data.headline = document.getElementById('inputHeadline')?.value || '';
                    state.data.body = document.getElementById('inputBody')?.value || '';
                    state.data.cta = document.getElementById('inputCta')?.value || null;
                    break;

                case 'stat':
                    state.data.label = document.getElementById('inputLabel')?.value || '';
                    state.data.stat = document.getElementById('inputStat')?.value || '';
                    state.data.statLabel = document.getElementById('inputStatLabel')?.value || '';
                    state.data.description = document.getElementById('inputDescription')?.value || '';
                    state.data.source = document.getElementById('inputSource')?.value || '';
                    break;

                case 'checklist':
                    state.data.badge = document.getElementById('inputBadge')?.value || null;
                    state.data.label = document.getElementById('inputLabel')?.value || '';
                    state.data.headline = document.getElementById('inputHeadline')?.value || '';
                    state.data.cta = document.getElementById('inputCta')?.value || null;

                    const itemsText = document.getElementById('inputItems')?.value || '';
                    state.data.items = itemsText.split('\n').filter(l => l.trim()).map(line => ({
                        text: line.replace(/^[+-]\s*/, ''),
                        status: line.trim().startsWith('+') ? 'good' : 'bad'
                    }));
                    break;

                case 'quote':
                    state.data.quote = document.getElementById('inputQuote')?.value || '';
                    state.data.attribution = document.getElementById('inputAttribution')?.value || '';
                    state.data.author = document.getElementById('inputAuthor')?.value || '';
                    state.data.authorTitle = document.getElementById('inputAuthorTitle')?.value || '';
                    break;
            }
        }

        // ========================================
        // PREVIEW RENDERING
        // ========================================
        function renderPreview() {
            const preview = document.getElementById('slidePreview');

            // Update classes
            preview.className = `slide-preview size-${state.format} theme-${state.theme}`;

            // Custom gradient
            if (state.gradient) {
                preview.style.background = `linear-gradient(135deg, ${state.gradient.start}, ${state.gradient.end})`;
            } else {
                preview.style.background = '';
            }

            // Render template based on type
            let html = '';

            // Logo
            html += `
                <div class="logo-wrapper" style="left: ${state.logo.x}%; top: ${state.logo.y}%; height: ${state.logo.zoom}px;">
                    <img src="../../svg/${state.logo.file}" alt="Logo">
                </div>
            `;

            switch (state.templateType) {
                case 'statement':
                    html += renderStatementTemplate();
                    break;
                case 'stat':
                    html += renderStatTemplate();
                    break;
                case 'checklist':
                    html += renderChecklistTemplate();
                    break;
                case 'quote':
                    html += renderQuoteTemplate();
                    break;
            }

            preview.innerHTML = html;
        }

        function renderStatementTemplate() {
            const d = state.data;
            const badgeClass = d.badgeColor === 'danger' ? 'badge-danger' : 'badge-accent';

            return `
                <div class="tpl-statement">
                    ${d.badge ? `<div class="badge ${badgeClass}">${d.badge}</div>` : ''}
                    <div class="content-area">
                        ${d.brand ? `<div class="brand">${d.brand}</div>` : ''}
                        ${d.headline ? `<div class="headline">${parseRichText(d.headline)}</div>` : ''}
                        ${d.body ? `<div class="body">${parseRichText(d.body)}</div>` : ''}
                    </div>
                    ${d.cta ? `<div class="cta">${d.cta}</div>` : ''}
                </div>
            `;
        }

        function renderStatTemplate() {
            const d = state.data;
            return `
                <div class="tpl-stat">
                    ${d.label ? `<div class="label">${d.label}</div>` : ''}
                    <div class="stat-box">
                        <div class="stat-value">${d.stat || ''}</div>
                        <div class="stat-label">${d.statLabel || ''}</div>
                    </div>
                    ${d.description ? `<div class="description">${d.description}</div>` : ''}
                    ${d.source ? `<div class="source">${d.source}</div>` : ''}
                </div>
            `;
        }

        function renderChecklistTemplate() {
            const d = state.data;
            const badgeClass = d.badgeColor === 'danger' ? 'badge-danger' : 'badge-accent';
            const items = d.items || [];

            return `
                <div class="tpl-checklist">
                    ${d.badge ? `<div class="badge ${badgeClass}" style="display:inline-block;padding:8px 16px;border-radius:6px;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:16px;background:${d.badgeColor === 'danger' ? 'rgba(243,49,68,0.15)' : 'rgba(13,148,136,0.15)'};color:${d.badgeColor === 'danger' ? 'var(--color-danger)' : 'var(--color-accent)'};">${d.badge}</div>` : ''}
                    ${d.label ? `<div class="label">${d.label}</div>` : ''}
                    ${d.headline ? `<div class="headline">${parseRichText(d.headline)}</div>` : ''}
                    <div class="items">
                        ${items.map(item => `
                            <div class="item">
                                <div class="item-icon ${item.status}">${item.status === 'good' ? '' : ''}</div>
                                <span>${item.text}</span>
                            </div>
                        `).join('')}
                    </div>
                    ${d.cta ? `<div class="cta">${d.cta}</div>` : ''}
                </div>
            `;
        }

        function renderQuoteTemplate() {
            const d = state.data;
            return `
                <div class="tpl-quote">
                    <div class="quote-mark">"</div>
                    <div class="quote-text">${d.quote || ''}</div>
                    <div class="divider"></div>
                    ${d.attribution ? `<div class="attribution">${d.attribution}</div>` : ''}
                    <div class="author-box">
                        <div class="author-name">${d.author || ''}</div>
                        <div class="author-title">${d.authorTitle || ''}</div>
                    </div>
                </div>
            `;
        }

        function parseRichText(text) {
            if (!text) return '';
            let escaped = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            escaped = escaped.replace(/\n/g, '<br>');
            const colorMap = {
                'red': 'var(--color-danger)',
                'teal': 'var(--color-accent)',
                'green': 'var(--color-success)',
                'yellow': 'var(--color-secondary)',
                'orange': 'var(--color-warning)'
            };
            return escaped.replace(/\[(\w+):([^\]]+)\]/g, (match, color, content) => {
                const cssColor = colorMap[color.toLowerCase()];
                if (cssColor) return `<span style="color: ${cssColor};">${content}</span>`;
                return content;
            });
        }

        // ========================================
        // EXPORT
        // ========================================
        async function downloadImage() {
            const preview = document.getElementById('slidePreview');
            const dimensions = {
                square: { width: 1080, height: 1080 },
                portrait: { width: 1080, height: 1350 },
                landscape: { width: 1200, height: 628 }
            };
            const dim = dimensions[state.format];

            const canvas = await html2canvas(preview, {
                scale: dim.width / preview.offsetWidth,
                useCORS: true,
                allowTaint: true,
                backgroundColor: null
            });

            const link = document.createElement('a');
            link.download = `rme-${state.templateType}-${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        async function copyToClipboard() {
            const preview = document.getElementById('slidePreview');
            const dimensions = {
                square: { width: 1080, height: 1080 },
                portrait: { width: 1080, height: 1350 },
                landscape: { width: 1200, height: 628 }
            };
            const dim = dimensions[state.format];

            const canvas = await html2canvas(preview, {
                scale: dim.width / preview.offsetWidth,
                useCORS: true,
                allowTaint: true,
                backgroundColor: null
            });

            canvas.toBlob(async (blob) => {
                try {
                    await navigator.clipboard.write([
                        new ClipboardItem({ 'image/png': blob })
                    ]);
                    alert('Copied to clipboard!');
                } catch (err) {
                    alert('Failed to copy to clipboard');
                }
            });
        }
    </script>
</body>
</html>
